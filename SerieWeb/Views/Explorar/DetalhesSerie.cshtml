@model  SerieWeb.Models.Admininstracao.Serie
@{
    ViewBag.Title = "Detalhes Serie";

    var Indicacoes = (List<SerieWeb.Models.Admininstracao.Serie>)ViewBag.Indicacoes;
    var Episodios = (List<SerieWeb.Models.Admininstracao.Episodio>)ViewBag.Episodios;
    var Temporadas = (List<SerieWeb.Models.Admininstracao.Temporada>)ViewBag.listatemporada;
    var TrailerCompartilhar = ViewBag.TrailerCompartilhar;

}



<div id="Desktop">
    <div class="container-fluid DetalhesSerie" id="toTop">
        <div class="containerDetalhesSerie container">
            <div class="row">
                <div class="col-sm-4 col-md-4 col-lg-4 col-xl-4 containerImagemdetalhes">
                    <img src="@Model.Imagem" class="img-seriedetalhes img-responsive rounded mx-auto d-block" alt="Responsive image">
                </div>
                <div class="col-8 containerInfoDetalhes">
                    <div class="row">
                        <h1 class="text-white">@Model.NomeSerie</h1>
                        <hr />
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <br />
                            <h2 class="text-white">Sinopse</h2>
                            <p class="text-justify text-white">@Model.Sinopse</p>
                            <br />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-3">
                            <button type="button" class="btn btn-default BtnStar">
                                <img src="~/Content/SVG/star.svg" /> Classificar
                            </button>
                        </div>
                        <div class="col-3">
                            @if (User.Identity.IsAuthenticated == true)
                            {
                                using (Html.BeginForm("SalvarFavorito", "Explorar", FormMethod.Post))
                                {
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="IdSerie" value="@Model.SerieID" />
                                    <button type="submit" class="btn btn-default BtnFavorito" data-toggle="tooltip" data-placement="bottom" title="Adicionar aos Favoritos"><img src="~/Content/SVG/favorito.svg" /> Favoritar</button>
                                }
                            }
                            else
                            {
                                <button class="btn btn-default BtnFavorito" data-toggle="tooltip" data-placement="bottom" title="Faça o login e adicione a sua lista de Favoritos">
                                    <img src="~/Content/SVG/favorito.svg" /> Favoritar
                                </button>
                            }
                        </div>
                        <div class="col-3">
                            @if (User.Identity.IsAuthenticated == true)
                            {
                                using (Html.BeginForm("InteresseSerie", "Explorar", FormMethod.Post))
                                {
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="IdSerie" value="@Model.SerieID" />
                                    <button type="submit" class="btn btn-default BtnLike" data-toggle="tooltip" data-placement="bottom" title="Adicionar a lista de interesse"><img src="~/Content/SVG/like.svg" /> Interesse </button>
                                }

                            }
                            else
                            {
                                <button type="button" class="btn btn-default BtnLike" data-toggle="tooltip" data-placement="bottom" title="Faça o login para adicionar a sua lista de interesse">
                                    <img src="~/Content/SVG/like.svg" /> Interesse
                                </button>
                            }
                        </div>
                        <div class="col-3">
                            <button href="#trailer" class="btn btn-default BtnFavorito">
                                <img src="~/Content/SVG/play.svg" /> Assistir trailer
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
<div class="container">
    @if (ViewBag.listaTemporada != null)
    {
        <div class="col-sm-4">
            <label for="Temporadas">Temporadas</label>
            <select class="form-control" id="Temporada" name="ListTemporadas">
                @foreach (var item in Temporadas)
                {
                    <option value="@item.TemporadaID"> @item.NomeTemporada </option>
                }
            </select>
        </div>
    }

    <table id="Tabela-Episodio" class="table table-hover">
        <thead>
            <tr>
                <th>Nª</th>
                <th class="col">Episódio</th>
                <th class="col">Data</th>                
            </tr>
        </thead>
        <tbody id="dadosTabela-Episodio">
            <!-- CARREGA VIA AJAX -->
        </tbody>
    </table>


    @if (TrailerCompartilhar != null)
    {
        <div id="trailer">        

            <h4> Trailer </h4>        

            <div class="embed-responsive embed-responsive-16by9">
                <iframe width="560" height="315" src="https://youtube.com/embed/@TrailerCompartilhar" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
            </div>
        </div>
    }

    <div class="row">
        <div class="col-lg-12">
            <hr />
            <h4>Indicações</h4>
            <hr />

            <div class="row">

                @foreach (var item in Indicacoes)
                {

                    <div class="col-2">
                        <img class="card-img" src="@item.Imagem" alt="Card image cap" style="height:150px; width:100px;">

                    </div>
                    <div class="col-2">
                        <h5 class="card-title">@item.NomeSerie</h5>
                        <p class="card-text">@item.Nota</p>
                    </div>
                }

            </div>


        </div>

    </div>
    <div id="coments">        
        <h4>Comentarios</h4>        
        <div class="fb-comments" data-href="@Request.Url.ToString()" data-numposts="5"></div>
    </div>
</div>



@section Scripts {
    @Scripts.Render("~/bundles/popper")
    @Scripts.Render("~/bundles/bootstrap")
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })

        $(function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = 'https://connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v2.12';
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));

        //Função que exibe a movimentação de equipamentos de um contrato
        $("#Temporada").change(function () {
            
            var TemporadaID = $('#Temporada').val();
            var SerieID = @Model.SerieID;

            $.ajax({
                type: "POST",
                async: false,
                url: "/Explorar/ExiberEpisodio",
                data: { TemporadaID: TemporadaID, SerieID: SerieID },
                dataType: "json",
                cache: false,
                success: function (result) {
                    if (result.listaEpisodio != null) {
                        

                        var resultado = "";
                        var count = 0;
                        $.each(result.listaEpisodio, function (idx, elem) {
                            resultado += "<tr>";
                            resultado += "<td>" + count++ + "</td>"
                            resultado += "<td>" + elem.NomeEpisodio + "</td>"
                            resultado += "<td>" + elem.DataEpisodio + "</td>";
                            resultado += "</tr>";
                        });

                        //carrega a movimentação dos equipamentos do contrato
                        $("#dadosTabela-Episodio").html(resultado);


                    }

                }
            });
        });

    </script>

}
